<!DOCTYPE html>
<html>
  <body>
    <h2>S3 Presigned POST Test</h2>
    <button onclick="upload()">Upload JSON</button>
    <pre id="log"></pre>

    <script>
      async function upload() {
        const log = document.getElementById("log");
        log.textContent = "Uploading...\n";

        // Your S3 regional endpoint
        const url = "https://jaetill.game.nights.s3.us-east-1.amazonaws.com/";

        // Paste your generated fields here
        const fields = {
          "key": "gameNights.json",
          "Content-Type": "application/json",
          "x-amz-algorithm": "AWS4-HMAC-SHA256",
          "x-amz-credential": "AKIATD5ZASBEN3WXOFMW/20250619/us-east-1/s3/aws4_request",
          "x-amz-date": "20250619T113231ZZ",
          "policy": "eyJleHBpcmF0aW9uIjoiMjAyNS0wNi0xOVQxMTozNzozMS41MzBaIiwiY29uZGl0aW9ucyI6W3siYnVja2V0IjoiamFldGlsbC5nYW1lLm5pZ2h0cyJ9LFsic3RhcnRzLXdpdGgiLCIka2V5IiwiZ2FtZU5pZ2h0cy5qc29uIl0seyJDb250ZW50LVR5cGUiOiJhcHBsaWNhdGlvbi9qc29uIn0seyJ4LWFtei1hbGdvcml0aG0iOiJBV1M0LUhNQUMtU0hBMjU2In0seyJ4LWFtei1jcmVkZW50aWFsIjoiQUtJQVRENVpBU0JFTjNXWE9GTVcvMjAyNTA2MTkvdXMtZWFzdC0xL3MzL2F3czRfcmVxdWVzdCJ9LHsieC1hbXotZGF0ZSI6IjIwMjUwNjE5VDExMzIzMVpaIn1dfQ==",
          "x-amz-signature": "fdd3cc497904ef77c8b69966ef9c570d327fc8fb496ba9935b7a3434874a3083"
        };

        const formData = new FormData();
        for (const name in fields) {
          formData.append(name, fields[name]);
        }

        const blob = new Blob(
          [JSON.stringify({ from: "manual policy POST", success: true }, null, 2)],
          { type: "application/json" }
        );
        formData.append("file", blob); // Must be 'file' field

        try {
          const res = await fetch(url, {
            method: "POST",
            body: formData
          });

          if (res.ok) {
            log.textContent += "✅ Upload succeeded!";
          } else {
            log.textContent += `❌ Upload failed: ${res.status}`;
          }
        } catch (e) {
          log.textContent += `❌ Error: ${e.message}`;
        }
      }
    </script>
  </body>
</html>
