<!DOCTYPE html>
<html>
  <body>
    <h2>S3 Presigned POST Test</h2>
    <button onclick="upload()">Upload JSON</button>
    <pre id="log"></pre>

    <script>
      async function upload() {
        const log = document.getElementById("log");
        log.textContent = "Uploading...\n";

        // Your S3 regional endpoint
        const url = "https://jaetill-game-nights.s3.us-east-1.amazonaws.com";

        // Paste your generated fields here
        const fields = {
          "key": "gameNights.json",
          "Content-Type": "application/json",
          "x-amz-algorithm": "AWS4-HMAC-SHA256",
          "x-amz-credential": "AKIATD5ZASBEN3WXOFMW/20250619/us-east-1/s3/aws4_request",
          "x-amz-date": "20250619T114358Z",
          "policy": "eyJleHBpcmF0aW9uIjoiMjAyNS0wNi0xOVQxMTo0ODo1OFoiLCJjb25kaXRpb25zIjpbWyJzdGFydHMtd2l0aCIsIiRDb250ZW50LVR5cGUiLCJhcHBsaWNhdGlvbi9qc29uIl0seyJDb250ZW50LVR5cGUiOiJhcHBsaWNhdGlvbi9qc29uIn0seyJidWNrZXQiOiJqYWV0aWxsLWdhbWUtbmlnaHRzIn0seyJYLUFtei1BbGdvcml0aG0iOiJBV1M0LUhNQUMtU0hBMjU2In0seyJYLUFtei1DcmVkZW50aWFsIjoiQUtJQVRENVpBU0JFTjNXWE9GTVcvMjAyNTA2MTkvdXMtZWFzdC0xL3MzL2F3czRfcmVxdWVzdCJ9LHsiWC1BbXotRGF0ZSI6IjIwMjUwNjE5VDExNDM1OFoifSx7ImtleSI6ImdhbWVOaWdodHMuanNvbiJ9XX0=",
          "x-amz-signature": "b81685e7bbeaf071b84b0bf21e700e0c0b1bb70174136d4f6423af74afb46f99"
        };

        const formData = new FormData();
        for (const name in fields) {
          formData.append(name, fields[name]);
        }

        const blob = new Blob(
          [JSON.stringify({ from: "manual policy POST", success: true }, null, 2)],
          { type: "application/json" }
        );
        formData.append("file", blob); // Must be 'file' field

        try {
          const res = await fetch(url, {
            method: "POST",
            body: formData
          });

          if (res.ok) {
            log.textContent += "✅ Upload succeeded!";
          } else {
            log.textContent += `❌ Upload failed: ${res.status}`;
          }
        } catch (e) {
          log.textContent += `❌ Error: ${e.message}`;
        }
      }
    </script>
  </body>
</html>
